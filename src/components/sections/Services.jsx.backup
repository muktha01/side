'use client';

import { useRef } from 'react';
import { motion, useScroll, useTransform } from 'framer-motion';

const services = [
  {
    id: '01',
    title: 'UI-UX Design',
    description:
      'As an agency our UI/UX teams focus on creating, visually appealing and user-friendly interfaces that significantly enhance engagement and user satisfaction. These intuitive experiences play a key role in custom software development services aimed at improving product usability.',
  },
  {
    id: '02',
    title: 'Mobile Apps',
    description:
      'We specialize in the development of innovative and user-friendly mobile applications for both iOS and Android platforms. Our process encompasses every stage, from initial concept and design to final deployment.',
  },
  {
    id: '03',
    title: 'Backend Development',
    description:
      'As an organization, we specialize in delivering responsive, secure, and user-friendly web solutions designed to enhance your online presence. With the expertise of a software development agency, we ensure your backend systems are scalable and future-ready.',
  },
  {
    id: '04',
    title: 'Web App Development',
    description:
      'We specialize in developing responsive web applications that deliver seamless user experiences across all devices and platforms.',
  },
  {
    id: '05',
    title: 'Artificial Intelligence',
    description:
      'We harness the power of AI to transform raw information into intelligent insights that drive decision-making. Through advanced systems built by experienced AI software developers, organizations gain the clarity and precision needed for long-term growth.',
  },
  {
    id: '06',
    title: 'Data Analysis & Data science',
    description:
      'We excel at uncovering data narratives through visualizations, forecasting, and insights that support strategic choices. These techniques are often embedded in custom application development services where real-time data plays a pivotal role in decision-making.',
  },
  {
    id: '07',
    title: 'Managed Cloud & DevOps',
    description:
      'We specialize in optimizing your cloud infrastructure and streamlining operations through Managed Cloud and DevOps services. These efforts are supported by custom web software development practices that emphasize automation, uptime, and agility.',
  },
  {
    id: '08',
    title: 'No Code Development Tools',
    description:
      'Quickly build applications without needing technical skills. Create solutions with simple drag-and-drop tools. Ideal for teams that need to move fast without relying on developers.',
  },
];

function ServiceVisual({ index, scrollProgress }) {
  // Calculate if this service is active based on scroll
  const startProgress = index / services.length;
  const endProgress = (index + 1) / services.length;
  
  const opacity = useTransform(
    scrollProgress,
    [startProgress - 0.1, startProgress, endProgress, endProgress + 0.1],
    [0, 1, 1, 0]
  );
  
  const scale = useTransform(
    scrollProgress,
    [startProgress - 0.1, startProgress, endProgress, endProgress + 0.1],
    [0.9, 1, 1, 0.9]
  );

  return (
    <motion.div
      style={{ opacity, scale }}
      className="absolute inset-0 flex items-center justify-center"
    >
      {/* Glassmorphic placeholder card */}
      <div className="relative w-full max-w-lg aspect-square">
        <div className="absolute inset-0 bg-gradient-to-br from-primary/20 via-cyan-500/10 to-transparent rounded-3xl backdrop-blur-xl border border-white/10" />
        
        {/* Decorative elements */}
        <div className="absolute inset-0 flex items-center justify-center">
          <div className="text-center">
            <div className="w-32 h-32 mx-auto mb-6 bg-primary/10 rounded-2xl flex items-center justify-center border border-primary/20">
              <span className="text-6xl font-bold text-primary/40">{services[index].id}</span>
            </div>
            <div className="space-y-2">
              <div className="h-2 w-48 bg-primary/20 rounded mx-auto" />
              <div className="h-2 w-32 bg-primary/10 rounded mx-auto" />
            </div>
          </div>
        </div>

        {/* Glow effect */}
        <div className="absolute -inset-4 bg-primary/5 blur-3xl rounded-full opacity-50" />
      </div>
    </motion.div>
  );
}

function ServiceContent({ service, index, scrollProgress }) {
  const startProgress = index / services.length;
  const endProgress = (index + 1) / services.length;
  
  const opacity = useTransform(
    scrollProgress,
    [startProgress - 0.1, startProgress, endProgress, endProgress + 0.1],
    [0, 1, 1, 0]
  );
  
  const x = useTransform(
    scrollProgress,
    [startProgress - 0.1, startProgress, endProgress, endProgress + 0.1],
    [-30, 0, 0, -30]
  );

  return (
    <motion.div
      style={{ opacity, x }}
      className="absolute inset-0 flex flex-col justify-center"
    >
      <div className="space-y-6">
        {/* Index */}
        <div className="text-7xl font-bold text-white/5">
          {service.id}
        </div>

        {/* Title */}
        <h3 className="text-4xl md:text-5xl font-bold text-white">
          {service.title}
        </h3>

        {/* Description */}
        <p className="text-lg text-gray-light leading-relaxed max-w-xl">
          {service.description}
        </p>

        {/* CTA Button */}
        <motion.button
          whileHover={{ scale: 1.05 }}
          whileTap={{ scale: 0.95 }}
          className="bg-[#0EA5E9] text-white font-semibold text-sm hover:bg-[#0284C7] transition-colors duration-200 shadow-lg shadow-[#0EA5E9]/20 inline-block"
          style={{
            paddingLeft: '1.5rem',
            paddingRight: '1.5rem',
            paddingTop: '0.5rem',
            paddingBottom: '0.5rem',
            borderRadius: '0.375rem',
          }}
        >
          Know More
        </motion.button>
      </div>
    </motion.div>
  );
}

function TimelineDot({ index, scrollProgress }) {
  const startProgress = index / services.length;
  const midProgress = (index + 0.5) / services.length;
  const endProgress = (index + 1) / services.length;
  
  const scale = useTransform(
    scrollProgress,
    [startProgress, midProgress, endProgress],
    [1, 1.8, 1]
  );
  
  const backgroundColor = useTransform(
    scrollProgress,
    [startProgress, midProgress, endProgress],
    ['rgba(255,255,255,0.2)', '#0EA5E9', 'rgba(255,255,255,0.2)']
  );

  return (
    <motion.div
      style={{ scale, backgroundColor }}
      className="w-3 h-3 rounded-full"
    />
  );
}

export default function Services() {
  const containerRef = useRef(null);
  
  // Track scroll progress through the entire section
  const { scrollYProgress } = useScroll({
    target: containerRef,
    offset: ['start start', 'end end'],
  });

  return (
    <section
      ref={containerRef}
      id="services"
      className="relative bg-black min-h-[350vh]"
    >
      {/* Sticky container that holds the layout */}
      <div className="sticky top-0 h-screen overflow-hidden">
        <div className="container-custom h-full flex items-center py-20">
          <div className="grid grid-cols-1 lg:grid-cols-[auto_1fr_1fr] gap-8 lg:gap-16 w-full">
            
            {/* Timeline (far left) - hidden on mobile */}
            <div className="hidden lg:flex relative flex-col items-center">
              {/* Vertical line */}
              <div className="absolute left-1/2 top-0 bottom-0 w-px bg-white/10 -translate-x-1/2" />
              
              {/* Timeline dots */}
              <div className="relative flex flex-col justify-evenly h-full z-10 py-8">
                {services.map((service, index) => (
                  <TimelineDot
                    key={service.id}
                    index={index}
                    scrollProgress={scrollYProgress}
                  />
                ))}
              </div>
            </div>

            {/* Left Content (sticky) */}
            <div className="relative min-h-[400px]">
              {services.map((service, index) => (
                <ServiceContent
                  key={service.id}
                  service={service}
                  index={index}
                  scrollProgress={scrollYProgress}
                />
              ))}
            </div>

            {/* Right Visual (sticky) - hidden on mobile */}
            <div className="hidden lg:block relative min-h-[400px]">
              {services.map((service, index) => (
                <ServiceVisual
                  key={service.id}
                  index={index}
                  scrollProgress={scrollYProgress}
                />
              ))}
            </div>
          </div>
        </div>
      </div>
    </section>
  );
}
